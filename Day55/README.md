Kubernetes Sidecar Containers



1]We have a web server container running the nginx image. The access and error logs generated by the web server are not critical enough to be placed on a persistent volume. However, Nautilus developers need access to the last 24 hours of logs so that they can trace issues and bugs. Therefore, we need to ship the access and error logs for the web server to a log-aggregation service. Following the separation of concerns principle, we implement the Sidecar pattern by deploying a second container that ships the error and access logs from nginx. Nginx does one thing, and it does it well—serving web pages. The second container also specializes in its task—shipping logs. Since containers are running on the same Pod, we can use a shared emptyDir volume to read and write logs.

1\. Create a pod named webserver.

2\. Create an emptyDir volume shared-logs.

3\. Create two containers from nginx and ubuntu images with latest tag only and remember to mention tag i.e nginx:latest, nginx container name should be nginx-container and ubuntu container name should be sidecar-container on webserver pod.

4\. Add command on sidecar-container "sh","-c","while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"

5\. Mount the volume shared-logs on both containers at location /var/log/nginx, all containers should be up and running.

Note: The kubectl utility on jump\_host has been configured to work with the kubernetes cluster.



->



Kubernetes Task: Implement Sidecar Pattern for Nginx Log Shipping



Objective:

Deploy a Pod with two containers — one running nginx as a web server and another running ubuntu to continuously ship logs. Both containers share logs via a common emptyDir volume.



Step 1: Understand the Scenario

1]Main container (nginx-container) → Runs the Nginx web server and generates access \& error logs.

2]Sidecar container (sidecar-container) → Reads and ships logs periodically using a simple shell loop.

3]Shared Volume (emptyDir) → Enables both containers to share the same log files at /var/log/nginx.





Step 2: Create Pod Manifest File

File name: webserver.yml



apiVersion: v1

kind: Pod

metadata:

&nbsp; name: webserver

spec:

&nbsp; volumes:

&nbsp;   - name: shared-logs

&nbsp;     emptyDir: {}

&nbsp; containers:

&nbsp;   - name: nginx-container

&nbsp;     image: nginx:latest

&nbsp;     volumeMounts:

&nbsp;       - name: shared-logs

&nbsp;         mountPath: /var/log/nginx

&nbsp;   - name: sidecar-container

&nbsp;     image: ubuntu:latest

&nbsp;     command: \["sh","-c","while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"]

&nbsp;     volumeMounts:

&nbsp;       - name: shared-logs

&nbsp;         mountPath: /var/log/nginx





Step 3: Apply Configuration

kubectl apply -f webserver.yml



Verify Pod creation:

kubectl get pods





Confirm both containers are running inside the Pod:

kubectl describe pod webserver





Step 4: Validate Shared Volume and Log Shipping

Check files in the shared volume:

kubectl exec -it webserver -c nginx-container -- ls /var/log/nginx

kubectl exec -it webserver -c sidecar-container -- ls /var/log/nginx





Monitor the log shipping activity from the sidecar container:

kubectl logs -f webserver -c sidecar-container



You should see logs being read every 30 seconds.





Key Notes:

emptyDir Volume:

1]Lives as long as the Pod exists.

2]Perfect for temporary log sharing or caching.

3]Automatically deleted when the Pod is terminated.





Sidecar Pattern:

1]Promotes separation of concerns — Nginx serves content, Ubuntu handles logs.

2]Improves modularity and reusability.





Common Mistakes to Avoid:

1]Use mountPath (singular), not mountPaths.

2]Always specify image tags explicitly (nginx:latest, ubuntu:latest).





Component	Expected Value

Pod Name	webserver

Volume Name	shared-logs

Volume Type	emptyDir

Container 1	nginx-container → nginx:latest

Container 2	sidecar-container → ubuntu:latest

Shared Mount Path	/var/log/nginx

Sidecar Command	while true; do cat ...; sleep 30; done

Pod Status	Running ✅



